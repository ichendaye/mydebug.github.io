<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://www.486255.com</id>
    <title>ChenC</title>
    <updated>2022-11-22T04:21:00.050Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://www.486255.com"/>
    <link rel="self" href="https://www.486255.com/atom.xml"/>
    <subtitle>94575594</subtitle>
    <logo>https://www.486255.com/images/avatar.png</logo>
    <icon>https://www.486255.com/favicon.ico</icon>
    <rights>All rights reserved 2022, ChenC</rights>
    <entry>
        <title type="html"><![CDATA[Swagger æœåŠ¡æ‰©å±•æ–¹æ³•]]></title>
        <id>https://www.486255.com/WPpHWzLjA/</id>
        <link href="https://www.486255.com/WPpHWzLjA/">
        </link>
        <updated>2022-11-17T13:54:43.000Z</updated>
        <content type="html"><![CDATA[<pre><code>[ApiVersion(&quot;1.0&quot;)]
[ControllerName(&quot;æ§åˆ¶å™¨åç§°&quot;)]
</code></pre>
<pre><code>/// &lt;summary&gt;
/// Swagger æœåŠ¡æ‰©å±•æ–¹æ³•
/// &lt;/summary&gt;
public static class SwaggerServiceCollectionExtensions
{
    /// &lt;summary&gt;
    /// æ·»åŠ  Swagger æ¥å£é…ç½®æ–‡æ¡£
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;services&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;xmlName&quot;&gt;å½“å‰æ¥å£é¡¹ç›®ç”Ÿæˆxmlæ–‡æ¡£æ–‡ä»¶å&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static IServiceCollection AddSwagger(this IServiceCollection services)
    {
        services.AddSwaggerGen(options =&gt;
        {
            // æ¥å£æ–‡æ¡£å®šä¹‰
            options.SwaggerDoc(&quot;v1&quot;, new OpenApiInfo
            {
                Title = $&quot;Api æ¥å£æ–‡æ¡£&quot;,
                Version = &quot;v1&quot;,
                Description = $&quot;åˆ‡æ¢ç‰ˆæœ¬è¯·ç‚¹å³ä¸Šè§’ç‰ˆæœ¬åˆ‡æ¢&quot;
            });
            // æ¥å£æ–‡æ¡£å®šä¹‰
            options.SwaggerDoc(&quot;v2&quot;, new OpenApiInfo
            {
                Title = $&quot;Api æ¥å£æ–‡æ¡£&quot;,
                Version = &quot;v2&quot;,
                Description = $&quot;åˆ‡æ¢ç‰ˆæœ¬è¯·ç‚¹å³ä¸Šè§’ç‰ˆæœ¬åˆ‡æ¢&quot;
            });
            //æ·»åŠ å…¨å±€å®‰å…¨æ€§éœ€æ±‚
            options.AddSecurityRequirement(new OpenApiSecurityRequirement
            {
                {
                    new OpenApiSecurityScheme
                    {
                        Reference = new OpenApiReference()
                        {
                            Type = ReferenceType.SecurityScheme,
                            Id = &quot;bearerAuth&quot;
                        }
                    }, Array.Empty&lt;string&gt;()
                }
            });

            //æ·»åŠ ä¸€ä¸ªå¿…é¡»çš„å…¨å±€å®‰å…¨ä¿¡æ¯ï¼Œå’ŒAddSecurityDefinitionæ–¹æ³•æŒ‡å®šçš„æ–¹æ¡ˆåç§°è¦ä¸€è‡´ï¼Œè¿™é‡Œæ˜¯Bearerã€‚
            options.AddSecurityDefinition(&quot;bearerAuth&quot;,
                new OpenApiSecurityScheme
                {
                    Description = &quot;JWT Authorization header using the Bearer scheme. Example: \&quot;Authorization: Bearer {token}\&quot;&quot;,
                    Name = &quot;Authorization&quot;,
                    In = ParameterLocation.Header,
                    Type = SecuritySchemeType.ApiKey,
                    //å†…å®¹ä¸ºä»¥ bearerå¼€å¤´
                    Scheme = &quot;bearer&quot;,
                    BearerFormat = &quot;JWT&quot;
                });


            // è·å–è‡ªå®šä¹‰çš„xmlç›®å½•    
            DirectoryInfo dir = new DirectoryInfo(AppContext.BaseDirectory);
            // è·å–ç›®å½•ä¸‹çš„æ‰€æœ‰xmlæ–‡ä»¶ï¼Œå¹¶è®¾ç½®ä¸ºswaggeræ–‡æ¡£åŒ…å«æ–‡ä»¶
            dir.GetFiles(&quot;WisdomClassRoom.*.xml&quot;).ToList().ForEach(u =&gt;
            {
                options.IncludeXmlComments(u.FullName, true);
            });
            // è·å–Xmlæ–‡æ¡£
            //var xmlPath = Path.Combine(AppContext.BaseDirectory, $@&quot;{xmlName}.xml&quot;);
            //options.IncludeXmlComments(xmlPath, true);
        });
        return services;
    }
}

</code></pre>
<pre><code>if (env.IsDevelopment())
{
    app.UseDeveloperExceptionPage();
    app.UseSwagger();
    app.UseSwaggerUI(c =&gt;
    {
        c.SwaggerEndpoint(&quot;/swagger/v1/swagger.json&quot;, &quot;Api v1&quot;);
        c.SwaggerEndpoint(&quot;/swagger/v2/swagger.json&quot;, &quot;Api v2&quot;);
        // æŠ˜å æ‰€æœ‰æ¥å£æ–‡æ¡£
        c.DocExpansion(DocExpansion.None);
    });
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Arrayæ•°ç»„å»é‡]]></title>
        <id>https://www.486255.com/pBiIzOPPV/</id>
        <link href="https://www.486255.com/pBiIzOPPV/">
        </link>
        <updated>2022-11-10T07:39:43.000Z</updated>
        <content type="html"><![CDATA[<p>ES6 æä¾›äº†æ–°çš„æ•°æ®ç»“æ„ Setã€‚å®ƒç±»ä¼¼äºæ•°ç»„ï¼Œä½†æ˜¯æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼<br>
Setå†…éƒ¨ä½¿ç”¨===æ¥åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼Œç±»ä¼¼'1'å’Œ1ä¼šä¸¤ä¸ªéƒ½ä¿å­˜ï¼ŒNaNå’ŒNaNåªä¼šä¿å­˜ä¸€ä¸ª<br>
ä¾‹ï¼š</p>
<pre><code>var a=[1,2,3,4,5,2,3,4]
var b=[...new Set(a)]
</code></pre>
<p>è¾“å‡ºb</p>
<pre><code>[1, 2, 3, 4, 5]
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¯¹è±¡ä½¿ç”¨åŠ¨æ€å­—æ®µå]]></title>
        <id>https://www.486255.com/0eRMtdVck/</id>
        <link href="https://www.486255.com/0eRMtdVck/">
        </link>
        <updated>2022-11-10T07:32:42.000Z</updated>
        <content type="html"><![CDATA[<p>ä½¿ç”¨<code>[]</code>ç¬¦å·<br>
ä¾‹ï¼š</p>
<pre><code>var field='userName'
var obj={
    [field]:'å¼ ä¸‰'
}
</code></pre>
<p>è¾“å‡ºobj</p>
<pre><code>{userName: 'å¼ ä¸‰'}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ¥å£ç»Ÿä¸€æ ¼å¼è¿”å›]]></title>
        <id>https://www.486255.com/U_NARu34-/</id>
        <link href="https://www.486255.com/U_NARu34-/">
        </link>
        <updated>2022-11-07T11:55:39.000Z</updated>
        <content type="html"><![CDATA[<h3 id="æ‰©å±•æ–¹æ³•">æ‰©å±•æ–¹æ³•</h3>
<pre><code>public class ModelActionFilter : ActionFilterAttribute
{
    /// &lt;summary&gt;
    /// åœ¨Controllerçš„Actionæ‰§è¡Œåæ‰§è¡Œ
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public override void OnActionExecuted(ActionExecutedContext context)
    {
        //ç‰¹æ®Šå¤„ç†ï¼šå¯¹æœ‰ApiResultIgnoreAttributeæ ‡ç­¾çš„ï¼Œä¸è¿›è¡Œè¿”å›ç»“æœåŒ…è£…ï¼ŒåŸæ ·è¾“å‡º
        var controllerActionDescriptor = context.ActionDescriptor as ControllerActionDescriptor;
        if (controllerActionDescriptor != null)
        {
            var isDefined = controllerActionDescriptor.EndpointMetadata.Any(a =&gt; a.GetType().Equals(typeof(ApiResultIgnoreAttribute)));
            if (isDefined)
            {
                return;
            }
        }
        // è¿”å›ç»“æœä¸ºJsonResultçš„è¯·æ±‚è¿›è¡ŒResultåŒ…è£…
        if (context.Result != null)
        {
            switch (context.Result)
            {
                case ObjectResult:
                    {
                        var result = context.Result as ObjectResult;
                        context.Result = new JsonResult(UniformResult&lt;object&gt;.Create(result.Value));
                        break;
                    }
                case EmptyResult:
                    context.Result = new JsonResult(UniformResult&lt;object&gt;.Create(null));
                    break;
                case ContentResult:
                    {
                        var result = context.Result as ContentResult;
                        context.Result = new JsonResult(UniformResult&lt;object&gt;.Create(result.Content));
                        break;
                    }
            }
        }

        base.OnActionExecuted(context);
    }

    /// &lt;summary&gt;
    /// åœ¨Controllerçš„Actionæ‰§è¡Œå‰æ‰§è¡Œ
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;
    public override void OnActionExecuting(ActionExecutingContext context)
    {
        //å¾ªç¯è·å–åœ¨Controllerçš„Actionæ–¹æ³•ä¸­å®šä¹‰çš„å‚æ•°
        foreach (var parameter in context.ActionDescriptor.Parameters)
        {
            var parameterName = parameter.Name;//è·å–Actionæ–¹æ³•ä¸­å‚æ•°çš„åå­—
            var parameterType = parameter.ParameterType;//è·å–Actionæ–¹æ³•ä¸­å‚æ•°çš„ç±»å‹

            //åˆ¤æ–­è¯¥Controllerçš„Actionæ–¹æ³•æ˜¯å¦æœ‰ç±»å‹ä¸ºBaseDtoçš„å‚æ•°
            if (parameterType.BaseType == typeof(CreateAndUpdateBaseDto))
            {
                //å¦‚æœæœ‰ï¼Œé‚£ä¹ˆå°±è·å–BaseDtoç±»å‹å‚æ•°çš„å€¼
                var baseEntity = context.ActionArguments[parameterName] as CreateAndUpdateBaseDto;
                if (baseEntity != null)
                {
                    // ä»tokenä¸­è·å–UserId
                    var userClaim = context.HttpContext.User.FindFirst(x =&gt; x.Type == ClaimTypes.NameIdentifier);
                    if (userClaim != null &amp;&amp; long.TryParse(userClaim.Value, out long userId))
                    {
                        // èµ‹å€¼å½“å‰ç”¨æˆ·Id
                        baseEntity.CreateId = userId;
                        baseEntity.UpdateId = userId;
                    }
                }
            }
        }

        base.OnActionExecuting(context);
    }
}

</code></pre>
<h3 id="startupä½¿ç”¨">Startupä½¿ç”¨</h3>
<pre><code>options.Filters.Add&lt;ModelActionFilter&gt;();
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å…¨å±€å¼‚å¸¸æ•è·]]></title>
        <id>https://www.486255.com/nOZ2Oduf6/</id>
        <link href="https://www.486255.com/nOZ2Oduf6/">
        </link>
        <updated>2022-11-07T11:52:27.000Z</updated>
        <content type="html"><![CDATA[<h3 id="æ‰©å±•æ–¹æ³•">æ‰©å±•æ–¹æ³•</h3>
<pre><code>/// &lt;summary&gt;
/// å…¨å±€å¼‚å¸¸æ•è·
/// &lt;/summary&gt;
public class GlobalExceptionFilter : IAsyncExceptionFilter
{
    private readonly ILogger&lt;GlobalExceptionFilter&gt; _logger;

    public GlobalExceptionFilter(ILogger&lt;GlobalExceptionFilter&gt; logger)
    {
        this._logger = logger; //åœ¨æ„é€ å‡½æ•°ä¸­æ³¨å…¥æ—¥å¿—å¤„ç†å®ä¾‹
    }

    public async Task OnExceptionAsync(ExceptionContext context)
    {
        // å¦‚æœå¼‚å¸¸æ²¡æœ‰è¢«å¤„ç†åˆ™è¿›è¡Œå¤„ç†
        if (context.ExceptionHandled == false)
        {
            // å®šä¹‰è¿”å›ç±»å‹
            UniformResult&lt;object&gt; result;

            // å¦‚æœä¸ºä¸šåŠ¡é€»è¾‘æŠ›å‡ºçš„å†…éƒ¨å¼‚å¸¸
            if (context.Exception is FriendlyInternalException ex)
            {
                // ä¼ä¸šå¾®ä¿¡å¼‚å¸¸é€šçŸ¥
                await ExceptionNotice.SendFriendlyExceptionAsync(ex);

                result = UniformResult&lt;object&gt;
                    .Create(ex.FriendlyData, ex.ErrorCode, context.Exception.Message);
            }
            else
            {
                // ç¨‹åºå¼‚å¸¸,ä¸å¯¹å¤–æš´éœ²ç¨‹åºå¼‚å¸¸ç»†èŠ‚
                result = UniformResult&lt;object&gt;
                   .Create(null, 500, &quot;ç¨‹åºå‡ºé”™å•¦ğŸğŸğŸï¼&quot;);

                //ä½¿ç”¨æ—¥å¿—å¯¹è±¡ _logger çš„ LogError() æ–¹æ³•å°†å¼‚å¸¸ä¿¡æ¯å†™å…¥æ—¥å¿—æ–‡ä»¶
                _logger.LogError(context.Exception, context.Exception.Message);

                // ä¼ä¸šå¾®ä¿¡å¼‚å¸¸é€šçŸ¥
                await ExceptionNotice.SendAsync(context.Exception);
            }

            context.Result = new ContentResult
            {
                // è¿”å›çŠ¶æ€ç è®¾ç½®ä¸º200ï¼Œè¡¨ç¤ºæˆåŠŸ
                StatusCode = StatusCodes.Status200OK,
                // è®¾ç½®è¿”å›æ ¼å¼
                ContentType = &quot;application/json;charset=utf-8&quot;,
                Content = result.ToJson(true)
            };


        }

        // è®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºå¼‚å¸¸å·²ç»è¢«å¤„ç†äº†
        context.ExceptionHandled = true;
    }
}

</code></pre>
<h3 id="startupä½¿ç”¨">Startupä½¿ç”¨</h3>
<pre><code>options.Filters.Add&lt;GlobalExceptionFilter&gt;();
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[giteaåˆ›å»ºæœåŠ¡]]></title>
        <id>https://www.486255.com/4BWEgMc88/</id>
        <link href="https://www.486255.com/4BWEgMc88/">
        </link>
        <updated>2022-11-07T10:14:04.000Z</updated>
        <summary type="html"><![CDATA[<p>æ‰“å¼€cmdï¼Œæ‰§è¡Œå‘½ä»¤</p>
]]></summary>
        <content type="html"><![CDATA[<p>æ‰“å¼€cmdï¼Œæ‰§è¡Œå‘½ä»¤</p>
<!-- more -->
<pre><code>sc create gitea binPath=&quot;C:\git\gitea-1.17.1-windows-4.0-amd64.exe web --config C:\git\custom\conf\app.ini&quot; start=auto
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[IIS é‡å®šå‘]]></title>
        <id>https://www.486255.com/-aEZ2bcZD/</id>
        <link href="https://www.486255.com/-aEZ2bcZD/">
        </link>
        <updated>2022-11-07T08:03:02.000Z</updated>
        <summary type="html"><![CDATA[<p>æ¡ä»¶è¾“å…¥ï¼š<code>{HTTPS}</code><br>
æ¨¡å¼ï¼š<code>off</code><br>
é‡å®šå‘urlï¼š<code>https://{HTTP_HOST}/{R:1}</code></p>
]]></summary>
        <content type="html"><![CDATA[<p>æ¡ä»¶è¾“å…¥ï¼š<code>{HTTPS}</code><br>
æ¨¡å¼ï¼š<code>off</code><br>
é‡å®šå‘urlï¼š<code>https://{HTTP_HOST}/{R:1}</code></p>
<!-- more -->
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç®€å•æ— å¯†ç å…±äº«]]></title>
        <id>https://www.486255.com/uUrNJrw7j/</id>
        <link href="https://www.486255.com/uUrNJrw7j/">
        </link>
        <updated>2022-11-07T07:58:39.000Z</updated>
        <summary type="html"><![CDATA[<p>ä¿®æ”¹æœ¬åœ°å®‰å…¨ç­–ç•¥</p>
<blockquote>
<p>ï¼ˆè¿™é‡Œçš„ä¿®æ”¹å¾ˆé‡è¦ï¼Œwin7å’Œwin8ã€æ‹’ç»ä»ç½‘ç»œè®¿é—®è¿™å°è®¡ç®—æœºã€‘é»˜è®¤ä¸ºç©ºï¼Œåªæœ‰win10é»˜è®¤æ·»åŠ äº†guestï¼‰</p>
</blockquote>
]]></summary>
        <content type="html"><![CDATA[<p>ä¿®æ”¹æœ¬åœ°å®‰å…¨ç­–ç•¥</p>
<blockquote>
<p>ï¼ˆè¿™é‡Œçš„ä¿®æ”¹å¾ˆé‡è¦ï¼Œwin7å’Œwin8ã€æ‹’ç»ä»ç½‘ç»œè®¿é—®è¿™å°è®¡ç®—æœºã€‘é»˜è®¤ä¸ºç©ºï¼Œåªæœ‰win10é»˜è®¤æ·»åŠ äº†guestï¼‰</p>
</blockquote>
<!-- more -->
<p>WIN+Rç„¶åâ€œè¿è¡Œâ€é‡Œè¾“å…¥secpol.mscï¼Œæ‰“å¼€æœ¬åœ°å®‰å…¨ç­–ç•¥</p>
<p>1ã€ã€æœ¬åœ°ç­–ç•¥ã€‘â€”ã€å®‰å…¨é€‰é¡¹ã€‘â€”ã€ç½‘ç»œè®¿é—®ï¼šæœ¬åœ°è´¦æˆ·çš„å…±äº«å’Œå®‰å…¨æ¨¡å‹ã€‘<br>
æ”¹æ¥å®¾</p>
<p>2ã€ã€æœ¬åœ°ç­–ç•¥ã€‘â€”ã€å®‰å…¨é€‰é¡¹ã€‘â€”ã€è´¦æˆ·ï¼šæ¥å®¾è´¦æˆ·çŠ¶æ€ã€‘<br>
æ”¹å¯ç”¨</p>
<p>3ã€ã€æœ¬åœ°ç­–ç•¥ã€‘â€”ã€ç”¨æˆ·æƒé™åˆ†é…ã€‘â€”ã€æ‹’ç»ä»ç½‘ç»œè®¿é—®è¿™å°è®¡ç®—æœºã€‘<br>
åˆ é™¤guest</p>
<p>å…±äº«ï¼ševeryone<br>
é«˜çº§å…±äº«é‡Œè®¾ç½®ä¸ºæ— å¯†ç ä¿æŠ¤çš„å…±äº«</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‰ç«¯è·¨é¡µé¢é€šä¿¡]]></title>
        <id>https://www.486255.com/nxJJuoO1x/</id>
        <link href="https://www.486255.com/nxJJuoO1x/">
        </link>
        <updated>2022-11-07T06:50:42.000Z</updated>
        <summary type="html"><![CDATA[<h3 id="broadcastchannelçš„ä½¿ç”¨æ–¹æ³•">BroadcastChannelçš„ä½¿ç”¨æ–¹æ³•</h3>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆè¦åˆå§‹åŒ–ä¸€ä¸‹BroadcastChannelï¼š</p>
<pre><code>const setChannel = new BroadcastChannel('demos');
</code></pre>
]]></summary>
        <content type="html"><![CDATA[<h3 id="broadcastchannelçš„ä½¿ç”¨æ–¹æ³•">BroadcastChannelçš„ä½¿ç”¨æ–¹æ³•</h3>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆè¦åˆå§‹åŒ–ä¸€ä¸‹BroadcastChannelï¼š</p>
<pre><code>const setChannel = new BroadcastChannel('demos');
</code></pre>
<!-- more -->
<p>ä¼ å…¥ä¸€ä¸ªstring,ç”¨è¿™ä¸ªæ¥æ ‡è¯†BroadcastChannel<br>
å‘é€æ¶ˆæ¯ï¼š å‘é€æ¶ˆæ¯çš„è¯ä½¿ç”¨å®ƒçš„postMessageæ–¹æ³•ï¼Œä½†æ˜¯è®°ä½åœ¨ä½¿ç”¨çš„é¡µé¢ä¹Ÿè¦åˆå§‹åŒ–BroadcastChannelï¼š</p>
<pre><code>setChannel.postMessage('è¦å‘é€æ¶ˆæ¯å•¦å•¦å•¦å•¦å•¦å•¦å•¦');
</code></pre>
<p>ç›‘å¬æ¶ˆæ¯ï¼š è¦æƒ³ç›‘å¬æ–¹æ³•çš„è¯ä½¿ç”¨onmessageæ–¹æ³•æ¥è·å–ï¼š</p>
<pre><code>setChannel.onmessage =function(e) {

    console.log('æ¥æ”¶åˆ°æ¶ˆæ¯:', e.data);

    //ä¸€å¤§æ³¢ä½ è¦è¦çš„æ“ä½œ

};
</code></pre>
<p>å…³é—­è¿æ¥ï¼š</p>
<pre><code>setChannel..close();
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[é¡µé¢çŠ¶æ€ç›‘å¬]]></title>
        <id>https://www.486255.com/ye-mian-zhuang-tai-jian-ting/</id>
        <link href="https://www.486255.com/ye-mian-zhuang-tai-jian-ting/">
        </link>
        <updated>2022-11-07T06:43:38.000Z</updated>
        <content type="html"><![CDATA[<pre><code>document.addEventListener(&quot;visibilitychange&quot;, () =&gt; {
    if (document.visibilityState === &quot;visible&quot;) {
        // page is visible
    } else {
        // page is hidden
    }
});
</code></pre>
]]></content>
    </entry>
</feed>